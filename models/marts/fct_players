with dim_player as 
(
    select * from {{ref('dim_player)}}
),

event as
(
    select * from {{ref('fct_event)}}
)

final as
(
    select 
      dim_player.player_id
    , dim_player.player_name,
    , dim_player.age
    , dim_player.birth_date
    , dim_player.weight
    , dim_player.height
    , dim_player.city
    , dim_player.national_team_affiliation_id
    , dim_player.affiliation_id
    , sum(case when fct_event.event_type = 'goals' then 1 else 0) goal_count
    , sum(case when fct_event.event_type = 'misses' then 1 else 0) miss_count
    , sum(case when fct_event.event_type = 'cards' then 1 else 0) card_count
    , sum(case when fct_event.event_type = 'passes' then 1 else 0) pass_count
    from dim_player
    left join fct_event on dim_player.player_id = fct_event.player_id
    group by 1,2,3,4,5,6,7,8,9
)

select * from final